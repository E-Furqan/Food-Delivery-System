
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>AuthClient: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">github.com/E-Furqan/Food-Delivery-System/Client/AuthClient/authClient.go (0.0%)</option>
				
				<option value="file1">github.com/E-Furqan/Food-Delivery-System/Client/OrderClient/orderClient.go (0.0%)</option>
				
				<option value="file2">github.com/E-Furqan/Food-Delivery-System/Controllers/RoleControler/roleControler.go (0.0%)</option>
				
				<option value="file3">github.com/E-Furqan/Food-Delivery-System/Controllers/UserController/userController.go (0.0%)</option>
				
				<option value="file4">github.com/E-Furqan/Food-Delivery-System/DatabaseConfig/config.go (0.0%)</option>
				
				<option value="file5">github.com/E-Furqan/Food-Delivery-System/EnviormentVariable/env.go (31.6%)</option>
				
				<option value="file6">github.com/E-Furqan/Food-Delivery-System/Middleware/middleware.go (0.0%)</option>
				
				<option value="file7">github.com/E-Furqan/Food-Delivery-System/Repositories/TestDatabase/ConfigTestDatabase.go (78.9%)</option>
				
				<option value="file8">github.com/E-Furqan/Food-Delivery-System/Repositories/database.go (98.3%)</option>
				
				<option value="file9">github.com/E-Furqan/Food-Delivery-System/Route/routes.go (0.0%)</option>
				
				<option value="file10">github.com/E-Furqan/Food-Delivery-System/Utils/utils.go (5.7%)</option>
				
				<option value="file11">github.com/E-Furqan/Food-Delivery-System/main.go (0.0%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package AuthClient

import (
        "bytes"
        "encoding/json"
        "fmt"
        "net/http"

        model "github.com/E-Furqan/Food-Delivery-System/Models"
)

type AuthClient struct {
        model.AuthClientEnv
}

func NewClient(env model.AuthClientEnv) *AuthClient <span class="cov0" title="0">{
        return &amp;AuthClient{
                AuthClientEnv: env,
        }
}</span>
func (client *AuthClient) GenerateToken(input model.UserClaim) (*model.Tokens, error) <span class="cov0" title="0">{

        jsonData, err := json.Marshal(input)
        if err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error marshaling input: %v", err)
        }</span>
        <span class="cov0" title="0">url := fmt.Sprintf("%s%s%s", client.AuthClientEnv.BASE_URL, client.AuthClientEnv.AUTH_PORT, client.AuthClientEnv.GENERATE_TOKEN_URL)
        req, err := http.NewRequest("POST", url, bytes.NewBuffer(jsonData))
        if err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error creating request: %v", err)
        }</span>
        <span class="cov0" title="0">req.Header.Set("Content-Type", "application/json")

        resp, err := http.DefaultClient.Do(req)
        if err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error sending request: %v", err)
        }</span>
        <span class="cov0" title="0">defer resp.Body.Close()

        if resp.StatusCode != http.StatusOK </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("received non-200 response: %v", resp.Status)
        }</span>

        <span class="cov0" title="0">var tokens model.Tokens
        if err := json.NewDecoder(resp.Body).Decode(&amp;tokens); err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error decoding response: %v", err)
        }</span>

        <span class="cov0" title="0">return &amp;tokens, nil</span>
}

func (client *AuthClient) RefreshToken(input model.RefreshToken) (*model.Tokens, error) <span class="cov0" title="0">{

        jsonData, err := json.Marshal(input)
        if err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error marshaling input: %v", err)
        }</span>
        <span class="cov0" title="0">url := fmt.Sprintf("%s%s%s", client.AuthClientEnv.BASE_URL, client.AuthClientEnv.AUTH_PORT, client.AuthClientEnv.REFRESH_TOKEN_URL)
        req, err := http.NewRequest("POST", url, bytes.NewBuffer(jsonData))
        if err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error creating request: %v", err)
        }</span>
        <span class="cov0" title="0">req.Header.Set("Content-Type", "application/json")

        resp, err := http.DefaultClient.Do(req)
        if err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error sending request: %v", err)
        }</span>
        <span class="cov0" title="0">defer resp.Body.Close()

        if resp.StatusCode != http.StatusOK </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("received non-200 response: %v", resp.Status)
        }</span>

        <span class="cov0" title="0">var tokens model.Tokens
        if err := json.NewDecoder(resp.Body).Decode(&amp;tokens); err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error decoding response: %v", err)
        }</span>

        <span class="cov0" title="0">return &amp;tokens, nil</span>
}
</pre>
		
		<pre class="file" id="file1" style="display: none">package OrderClient

import (
        "bytes"
        "encoding/json"
        "fmt"
        "log"
        "net/http"

        model "github.com/E-Furqan/Food-Delivery-System/Models"
)

type OrderClient struct {
        model.OrderClientEnv
}

func NewClient(env model.OrderClientEnv) *OrderClient <span class="cov0" title="0">{
        return &amp;OrderClient{
                OrderClientEnv: env,
        }
}</span>

func (orderClient *OrderClient) UpdateOrderStatus(input model.UpdateOrder, token string) (*model.UpdateOrder, error) <span class="cov0" title="0">{

        jsonData, err := json.Marshal(input)
        if err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error marshaling input: %v", err)
        }</span>

        <span class="cov0" title="0">url := fmt.Sprintf("%s%s%s", orderClient.OrderClientEnv.BASE_URL, orderClient.OrderClientEnv.ORDER_PORT, orderClient.OrderClientEnv.UPDATE_ORDER_STATUS_URL)
        req, err := http.NewRequest("PATCH", url, bytes.NewBuffer(jsonData))
        if err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error creating request: %v", err)
        }</span>

        <span class="cov0" title="0">req.Header.Set("Content-Type", "application/json")
        req.Header.Set("Authorization", "Bearer "+token)

        resp, err := http.DefaultClient.Do(req)
        if err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error sending request: %v", err)
        }</span>
        <span class="cov0" title="0">defer resp.Body.Close()

        if resp.StatusCode != http.StatusOK </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("received non-200 response: %v", resp.Status)
        }</span>

        <span class="cov0" title="0">var orders model.UpdateOrder
        if err := json.NewDecoder(resp.Body).Decode(&amp;orders); err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error decoding response: %v", err)
        }</span>

        <span class="cov0" title="0">return &amp;orders, nil</span>
}

func (orderClient *OrderClient) AssignDriver(input model.UpdateOrder, token string) error <span class="cov0" title="0">{

        jsonData, err := json.Marshal(input)
        if err != nil </span><span class="cov0" title="0">{
                return fmt.Errorf("error marshaling input: %v", err)
        }</span>

        <span class="cov0" title="0">url := fmt.Sprintf("%s%s%s", orderClient.OrderClientEnv.BASE_URL, orderClient.OrderClientEnv.ORDER_PORT, orderClient.OrderClientEnv.ASSIGN_DRIVER_URL)
        req, err := http.NewRequest("PATCH", url, bytes.NewBuffer(jsonData))
        if err != nil </span><span class="cov0" title="0">{
                return fmt.Errorf("error creating request: %v", err)
        }</span>
        <span class="cov0" title="0">req.Header.Set("Content-Type", "application/json")
        req.Header.Set("Authorization", "Bearer "+token)

        resp, err := http.DefaultClient.Do(req)
        if err != nil </span><span class="cov0" title="0">{
                return fmt.Errorf("error sending request: %v", err)
        }</span>
        <span class="cov0" title="0">defer resp.Body.Close()

        if resp.StatusCode != http.StatusOK </span><span class="cov0" title="0">{
                return fmt.Errorf("received non-200 response: %v", resp.Status)
        }</span>

        <span class="cov0" title="0">return nil</span>
}

func (orderClient *OrderClient) ViewOrders(input model.UpdateOrder) (*[]model.UpdateOrder, error) <span class="cov0" title="0">{

        jsonData, err := json.Marshal(input)
        if err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error marshaling input: %v", err)
        }</span>
        <span class="cov0" title="0">url := fmt.Sprintf("%s%s%s", orderClient.OrderClientEnv.BASE_URL, orderClient.OrderClientEnv.ORDER_PORT, orderClient.OrderClientEnv.VIEW_ORDERS_URL)
        log.Print(url)
        req, err := http.NewRequest("GET", url, bytes.NewBuffer(jsonData))
        if err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error creating request: %v", err)
        }</span>
        <span class="cov0" title="0">req.Header.Set("Content-Type", "application/json")

        resp, err := http.DefaultClient.Do(req)
        if err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error sending request: %v", err)
        }</span>
        <span class="cov0" title="0">defer resp.Body.Close()

        if resp.StatusCode != http.StatusOK </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("received non-200 response: %v", resp.Status)
        }</span>

        <span class="cov0" title="0">var orders []model.UpdateOrder
        if err := json.NewDecoder(resp.Body).Decode(&amp;orders); err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error decoding response: %v", err)
        }</span>

        <span class="cov0" title="0">return &amp;orders, nil</span>
}

func (orderClient *OrderClient) ViewOrdersWithoutRider(input model.UpdateOrder) (*[]model.UpdateOrder, error) <span class="cov0" title="0">{

        jsonData, err := json.Marshal(input)
        if err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error marshaling input: %v", err)
        }</span>
        <span class="cov0" title="0">url := fmt.Sprintf("%s%s%s", orderClient.OrderClientEnv.BASE_URL, orderClient.OrderClientEnv.ORDER_PORT, orderClient.OrderClientEnv.VIEW_ORDER_WITHOUT_DRIVER_URL)
        log.Print(url)
        req, err := http.NewRequest("GET", url, bytes.NewBuffer(jsonData))
        if err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error creating request: %v", err)
        }</span>
        <span class="cov0" title="0">req.Header.Set("Content-Type", "application/json")

        resp, err := http.DefaultClient.Do(req)
        if err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error sending request: %v", err)
        }</span>
        <span class="cov0" title="0">defer resp.Body.Close()

        if resp.StatusCode != http.StatusOK </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("received non-200 response: %v", resp.Status)
        }</span>

        <span class="cov0" title="0">var orders []model.UpdateOrder
        if err := json.NewDecoder(resp.Body).Decode(&amp;orders); err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf("error decoding response: %v", err)
        }</span>

        <span class="cov0" title="0">return &amp;orders, nil</span>
}
</pre>
		
		<pre class="file" id="file2" style="display: none">package roleController

import (
        "log"
        "net/http"

        "github.com/E-Furqan/Food-Delivery-System/Client/AuthClient"
        model "github.com/E-Furqan/Food-Delivery-System/Models"
        database "github.com/E-Furqan/Food-Delivery-System/Repositories"
        utils "github.com/E-Furqan/Food-Delivery-System/Utils"
        "github.com/gin-gonic/gin"
)

type RoleController struct {
        Repo       *database.Repository
        AuthClient *AuthClient.AuthClient
}

func NewController(repo *database.Repository, AuthClient *AuthClient.AuthClient) *RoleController <span class="cov0" title="0">{
        return &amp;RoleController{
                Repo:       repo,
                AuthClient: AuthClient}
}</span>

func (rCtrl *RoleController) AddRolesByAdmin(c *gin.Context) <span class="cov0" title="0">{

        _, err := utils.VerifyActiveRole(c)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "Message", "user not authenticated", "error", err.Error())
                return
        }</span>

        <span class="cov0" title="0">var input model.Role
        if err := c.ShouldBindJSON(&amp;input); err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusBadRequest, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">var role model.Role
        role.RoleId = input.RoleId
        role.RoleType = input.RoleType

        err = rCtrl.Repo.CreateRole(&amp;role)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusInternalServerError, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">utils.GenerateResponse(http.StatusOK, c, "Message", "Role added successfully", "", nil)</span>
}

func (rCtrl *RoleController) GetRoles(c *gin.Context) <span class="cov0" title="0">{

        _, err := utils.VerifyActiveRole(c)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "Message", "user not authenticated", "error", err.Error())
                return
        }</span>

        <span class="cov0" title="0">RoleData, err := rCtrl.Repo.GetAllRoles()
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusInternalServerError, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">c.JSON(http.StatusOK, RoleData)</span>
}

func (rCtrl *RoleController) DeleteRole(c *gin.Context) <span class="cov0" title="0">{

        _, err := utils.VerifyActiveRole(c)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "Message", "user not authenticated", "error", err.Error())
                return
        }</span>

        <span class="cov0" title="0">var input model.Role
        var Role model.Role
        err = c.ShouldBindJSON(&amp;input)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusBadRequest, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">err = rCtrl.Repo.GetRole(input.RoleId, &amp;Role)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusNotFound, c, "Message", "Role does not exist", "error", err.Error())
                return
        }</span>

        <span class="cov0" title="0">if err := rCtrl.Repo.DeleteUserRoleInfo(input.RoleId, "role_role_id"); err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusInternalServerError, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">if err := rCtrl.Repo.DeleteRole(&amp;Role); err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusInternalServerError, c, "Message", "Failed to delete the role", "error", err.Error())
                return
        }</span>

        <span class="cov0" title="0">utils.GenerateResponse(http.StatusOK, c, "Message", "Role deleted successfully", "", nil)</span>
}

func (rCtrl *RoleController) AddDefaultRoles(c *gin.Context) <span class="cov0" title="0">{
        var roles []model.Role

        for _, RolesFromPayLoad := range model.RolesList </span><span class="cov0" title="0">{
                var existingRole model.Role
                err := rCtrl.Repo.GetRole(RolesFromPayLoad.RoleId, &amp;existingRole)
                if err == nil </span><span class="cov0" title="0">{

                        log.Printf("Role %v already exists, skipping.", RolesFromPayLoad.RoleId)
                        continue</span>
                }

                <span class="cov0" title="0">roles = append(roles, model.Role{
                        RoleId:   RolesFromPayLoad.RoleId,
                        RoleType: RolesFromPayLoad.RoleType,
                })</span>
        }

        <span class="cov0" title="0">if len(roles) == 0 </span><span class="cov0" title="0">{
                log.Println("No new roles to add, exiting function.")
                return
        }</span>

        <span class="cov0" title="0">err := rCtrl.Repo.BulkCreateRoles(roles)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusInternalServerError, c, "Message", "Failed to add default roles", "error", err.Error())
                return
        }</span>

        <span class="cov0" title="0">log.Printf("Message: Default roles added successfully ")</span>
}

func (RoleController *RoleController) SwitchRole(c *gin.Context) <span class="cov0" title="0">{

        UserId, err := utils.VerifyUserId(c)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusNotFound, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">var user model.User
        err = RoleController.Repo.GetUser("user_id", UserId, &amp;user)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusNotFound, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">var RoleSwitch model.RoleSwitch
        err = c.ShouldBindJSON(&amp;RoleSwitch)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusBadRequest, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">var roleExists bool
        var newRole model.Role
        for _, role := range user.Roles </span><span class="cov0" title="0">{
                if role.RoleId == RoleSwitch.NewRoleID </span><span class="cov0" title="0">{
                        roleExists = true
                        newRole = role
                        break</span>
                }
        }

        <span class="cov0" title="0">if !roleExists </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusNotFound, c, "error", "Role not found in user's roles", "", nil)
                return
        }</span>

        <span class="cov0" title="0">user.ActiveRole = newRole.RoleType

        if err := RoleController.Repo.UpdateUserActiveRole(&amp;user); err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusInternalServerError, c, "error", "Failed to update user active role", "", nil)
                return
        }</span>

        <span class="cov0" title="0">UserClaim := utils.CreateUserClaim(user)

        token, err := RoleController.AuthClient.GenerateToken(UserClaim)
        if err != nil </span><span class="cov0" title="0">{
                c.JSON(http.StatusInternalServerError, gin.H{"error": "Could not generate token"})
                return
        }</span>

        <span class="cov0" title="0">c.JSON(http.StatusOK, gin.H{
                "access token":  token.AccessToken,
                "refresh token": token.RefreshToken,
                "expires at":    token.Expiration,
        })</span>
}
</pre>
		
		<pre class="file" id="file3" style="display: none">package UserControllers

import (
        "log"
        "net/http"
        "strings"

        "github.com/E-Furqan/Food-Delivery-System/Client/AuthClient"
        "github.com/E-Furqan/Food-Delivery-System/Client/OrderClient"
        model "github.com/E-Furqan/Food-Delivery-System/Models"
        database "github.com/E-Furqan/Food-Delivery-System/Repositories"
        utils "github.com/E-Furqan/Food-Delivery-System/Utils"
        "github.com/gin-gonic/gin"
)

type Controller struct {
        Repo        *database.Repository
        OrderClient *OrderClient.OrderClient
        AuthClient  *AuthClient.AuthClient
}

func NewController(repo *database.Repository, OrderClient *OrderClient.OrderClient, AuthClient *AuthClient.AuthClient) *Controller <span class="cov0" title="0">{
        return &amp;Controller{
                Repo:        repo,
                OrderClient: OrderClient,
                AuthClient:  AuthClient,
        }
}</span>

func (ctrl *Controller) Register(c *gin.Context) <span class="cov0" title="0">{

        var registrationData model.User

        if err := c.ShouldBindJSON(&amp;registrationData); err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusBadRequest, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">if len(registrationData.Roles) &gt; 0 &amp;&amp; registrationData.ActiveRole == "" </span><span class="cov0" title="0">{
                var role model.Role
                if err := ctrl.Repo.GetRole(registrationData.Roles[0].RoleId, &amp;role); err != nil </span><span class="cov0" title="0">{
                        utils.GenerateResponse(http.StatusInternalServerError, c, "error", "Role not found", "", nil)
                        return
                }</span>
                <span class="cov0" title="0">registrationData.ActiveRole = role.RoleType
                log.Print("active role set")</span>
        }

        <span class="cov0" title="0">err := ctrl.Repo.CreateUser(&amp;registrationData)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusInternalServerError, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">c.JSON(http.StatusCreated, registrationData)</span>
}

func (ctrl *Controller) Login(c *gin.Context) <span class="cov0" title="0">{

        var input model.Credentials
        if err := c.ShouldBindJSON(&amp;input); err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusBadRequest, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">var user model.User
        err := ctrl.Repo.GetUser("username", input.Username, &amp;user)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "error", "Invalid credentials", "", nil)
                return
        }</span>
        <span class="cov0" title="0">if user.Password != input.Password </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "error", "Invalid credentials", "", nil)
                return
        }</span>

        <span class="cov0" title="0">UserClaim := utils.CreateUserClaim(user)

        token, err := ctrl.AuthClient.GenerateToken(UserClaim)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusInternalServerError, c, "error", "Could not generate token", "", nil)
                return
        }</span>
        <span class="cov0" title="0">c.JSON(http.StatusOK, gin.H{
                "access token":  token.AccessToken,
                "refresh token": token.RefreshToken,
                "expires at":    token.Expiration,
        })</span>
}

func (ctrl *Controller) GetUsers(c *gin.Context) <span class="cov0" title="0">{

        activeRole, exists := c.Get("activeRole")
        if !exists </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "error", "User not authenticated", "", nil)
                return
        }</span>

        <span class="cov0" title="0">if activeRole != "Admin" </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "error", "You do not have the privileges to view users.", "", nil)
                return
        }</span>

        <span class="cov0" title="0">var userData []model.User
        var OrderInfo model.Order

        if err := c.ShouldBindJSON(&amp;OrderInfo); err != nil </span><span class="cov0" title="0">{
                log.Print("binding error")
                utils.GenerateResponse(http.StatusBadRequest, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">userData, err := ctrl.Repo.FetchUsersWithRoles(OrderInfo.ColumnName, OrderInfo.OrderType)

        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusInternalServerError, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">c.JSON(http.StatusOK, userData)</span>
}

func (ctrl *Controller) UpdateUser(c *gin.Context) <span class="cov0" title="0">{

        UserId, err := utils.VerifyUserId(c)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">user := model.User{}
        err = ctrl.Repo.GetUser("user_id", UserId, &amp;user)

        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusNotFound, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">var updateUserData model.User
        err = c.ShouldBindJSON(&amp;updateUserData)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusBadRequest, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">if err := ctrl.Repo.DeleteUserRoleInfo(user.UserId, "user_user_id"); err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusInternalServerError, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">var roleType string
        for _, role := range updateUserData.Roles </span><span class="cov0" title="0">{
                if role.RoleId == 3 || role.RoleType == "Admin" </span><span class="cov0" title="0">{
                        roleType = "Admin"
                        break</span>
                } else<span class="cov0" title="0"> {
                        roleType = role.RoleType
                }</span>
        }

        <span class="cov0" title="0">user.Roles = updateUserData.Roles
        user.ActiveRole = roleType
        err = ctrl.Repo.Update(&amp;user, &amp;updateUserData)

        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusInternalServerError, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">for _, role := range updateUserData.Roles </span><span class="cov0" title="0">{
                if err := ctrl.Repo.AddUserRole(user.UserId, role.RoleId); err != nil </span><span class="cov0" title="0">{
                        utils.GenerateResponse(http.StatusInternalServerError, c, "error", err.Error(), "", nil)
                        return
                }</span>
        }
        <span class="cov0" title="0">c.JSON(http.StatusCreated, user)</span>
}

func (ctrl *Controller) DeleteUser(c *gin.Context) <span class="cov0" title="0">{
        UserId, err := utils.VerifyUserId(c)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">user := model.User{}
        err = ctrl.Repo.GetUser("user_id", UserId, &amp;user)

        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusNotFound, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">if err := ctrl.Repo.DeleteUserRoleInfo(user.UserId, "user_user_id"); err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusInternalServerError, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">if err := ctrl.Repo.DeleteUser(&amp;user); err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusInternalServerError, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">c.JSON(http.StatusOK, gin.H{"message": "User deleted successfully"})</span>
}

func (ctrl *Controller) Profile(c *gin.Context) <span class="cov0" title="0">{

        UserId, err := utils.VerifyUserId(c)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">var user model.User

        err = ctrl.Repo.GetUser("user_id", UserId, &amp;user)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusNotFound, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">c.JSON(http.StatusFound, user)</span>
}

func (ctrl *Controller) SearchForUser(c *gin.Context) <span class="cov0" title="0">{
        role, exists := c.Get("activeRole")
        if !exists </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "error", "User not authenticated", "", nil)
                return
        }</span>
        <span class="cov0" title="0">if role != "Admin" </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "error", "You do not have the privileges to Search for users.", "", nil)
                return
        }</span>

        <span class="cov0" title="0">var input model.UserSearch
        err := c.ShouldBindJSON(&amp;input)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusBadRequest, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">var user model.User
        err = ctrl.Repo.GetUser(input.ColumnName, input.SearchParameter, &amp;user)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusNotFound, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">c.JSON(http.StatusFound, user)</span>
}

func (ctrl *Controller) ViewUserOrders(c *gin.Context) <span class="cov0" title="0">{
        UserId, err := utils.VerifyUserId(c)

        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">var User model.User
        err = ctrl.Repo.GetUser("user_id", UserId, &amp;User)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusNotFound, c, "error", err.Error(), "", nil)
                return
        }</span>
        <span class="cov0" title="0">var userId model.UpdateOrder

        userId.UserID = User.UserId
        Orders, err := ctrl.OrderClient.ViewOrders(userId)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusInternalServerError, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">c.JSON(http.StatusOK, gin.H{
                "User orders: ": Orders,
        })</span>
}

func (ctrl *Controller) UpdateOrderStatus(c *gin.Context) <span class="cov0" title="0">{
        UserId, err := utils.VerifyUserId(c)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">token := utils.GetAuthToken(c)

        user := model.User{}
        err = ctrl.Repo.GetUser("user_id", UserId, &amp;user)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusNotFound, c, "error", "User not found", "", nil)
                return
        }</span>

        <span class="cov0" title="0">var order model.UpdateOrder
        if err := c.ShouldBindJSON(&amp;order); err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusBadRequest, c, "error", err.Error(), "", nil)
                return
        }</span>
        <span class="cov0" title="0">updatedOrder, err := ctrl.OrderClient.UpdateOrderStatus(order, token)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusBadRequest, c, "Message", "Patch request failed", "error", err.Error())
                return
        }</span>

        <span class="cov0" title="0">if strings.ToLower(updatedOrder.OrderStatus) == "completed" </span><span class="cov0" title="0">{
                if updatedOrder.DeliverDriverID == user.UserId </span><span class="cov0" title="0">{
                        user.RoleStatus = "Available"
                        ctrl.Repo.UpdateRoleStatus(&amp;user)
                }</span> else<span class="cov0" title="0"> {
                        user := model.User{}
                        err = ctrl.Repo.GetUser("user_id", updatedOrder.DeliverDriverID, &amp;user)
                        if err != nil </span><span class="cov0" title="0">{
                                utils.GenerateResponse(http.StatusNotFound, c, "error", "User not found", "", nil)
                                return
                        }</span>
                        <span class="cov0" title="0">user.RoleStatus = "Available"
                        ctrl.Repo.UpdateRoleStatus(&amp;user)</span>
                }
        }

        <span class="cov0" title="0">c.JSON(http.StatusOK, gin.H{
                "Message": "order status updated",
        })</span>
}

func (ctrl *Controller) ViewDriverOrders(c *gin.Context) <span class="cov0" title="0">{

        UserId, err := utils.VerifyUserId(c)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "Message", "user not authenticated", "error", err.Error())
                return
        }</span>

        <span class="cov0" title="0">activeRole, exists := c.Get("activeRole")
        if !exists </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "error", "User role does not exist", "", nil)
                return
        }</span>

        <span class="cov0" title="0">if activeRole != "Delivery driver" </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "error", "insufficient permission", "", nil)
                return
        }</span>

        <span class="cov0" title="0">var User model.User
        err = ctrl.Repo.GetUser("user_id", UserId, &amp;User)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "error", "User does not exist", "", nil)
                return
        }</span>

        <span class="cov0" title="0">var userId model.UpdateOrder
        userId.DeliverDriverID = User.UserId
        Orders, err := ctrl.OrderClient.ViewOrders(userId)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusBadGateway, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">c.JSON(http.StatusOK, gin.H{
                "Driver orders: ": Orders,
        })</span>
}

func (ctrl *Controller) ViewOrdersWithoutDriver(c *gin.Context) <span class="cov0" title="0">{
        UserId, err := utils.VerifyUserId(c)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "Message", "user not authenticated", "error", err.Error())
                return
        }</span>

        <span class="cov0" title="0">activeRole, exists := c.Get("activeRole")
        if !exists </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusBadRequest, c, "error", "User role does not exist", "", nil)
                return
        }</span>

        <span class="cov0" title="0">if activeRole != "Delivery driver" </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "error", "insufficient permission", "", nil)
                return
        }</span>

        <span class="cov0" title="0">var User model.User
        err = ctrl.Repo.GetUser("user_id", UserId, &amp;User)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "error", "User does not exist", "", nil)
                return
        }</span>

        <span class="cov0" title="0">var userId model.UpdateOrder
        Orders, err := ctrl.OrderClient.ViewOrdersWithoutRider(userId)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusBadGateway, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">c.JSON(http.StatusOK, gin.H{
                "Driver orders: ": Orders,
        })</span>
}

func (ctrl *Controller) AssignDriver(c *gin.Context) <span class="cov0" title="0">{
        UserId, err := utils.VerifyUserId(c)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "Message", "user not authenticated", "error", err.Error())
                return
        }</span>

        <span class="cov0" title="0">activeRole, exists := c.Get("activeRole")
        if !exists </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusNotFound, c, "error", "User role does not exist", "", nil)
                return
        }</span>

        <span class="cov0" title="0">if activeRole != "Delivery driver" </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "error", "insufficient permission", "", nil)
                return
        }</span>

        <span class="cov0" title="0">token := utils.GetAuthToken(c)

        var driver model.User
        err = ctrl.Repo.GetUser("user_id", UserId, &amp;driver)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusUnauthorized, c, "error", "User does not exist", "", nil)
                return
        }</span>

        <span class="cov0" title="0">var orderId model.UpdateOrder
        if err := c.ShouldBindJSON(&amp;orderId); err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusBadRequest, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">if err := ctrl.OrderClient.AssignDriver(orderId, token); err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusBadRequest, c, "Message", "Patch request failed", "error", err.Error())
                return
        }</span>

        <span class="cov0" title="0">driver.RoleStatus = "not available"
        ctrl.Repo.UpdateRoleStatus(&amp;driver)

        c.JSON(http.StatusOK, gin.H{
                "Message": "Delivery driver assigned to the order",
        })</span>
}
</pre>
		
		<pre class="file" id="file4" style="display: none">package config

import (
        "fmt"
        "log"

        model "github.com/E-Furqan/Food-Delivery-System/Models"
        "gorm.io/driver/postgres"
        "gorm.io/gorm"
)

type DatabaseConfig struct {
        model.DatabaseEnv
}

func NewDatabase(env model.DatabaseEnv) *DatabaseConfig <span class="cov0" title="0">{
        return &amp;DatabaseConfig{
                DatabaseEnv: env,
        }
}</span>

var DB *gorm.DB

func (DatabaseConfig *DatabaseConfig) Connection() *gorm.DB <span class="cov0" title="0">{

        var connection_string = fmt.Sprintf("host=%s port=%d user=%s password=%s dbname=%s sslmode=disable",
                DatabaseConfig.DatabaseEnv.DATABASE_HOST, DatabaseConfig.DatabaseEnv.DATABASE_PORT, DatabaseConfig.DatabaseEnv.DATABASE_USER, DatabaseConfig.DatabaseEnv.DATABASE_PASSWORD, DatabaseConfig.DatabaseEnv.DATABASE_NAME)

        DB, err := gorm.Open(postgres.Open(connection_string), &amp;gorm.Config{})
        log.Print(connection_string)
        if err != nil </span><span class="cov0" title="0">{
                log.Fatalf("Failed to connect to database: %v", err)
        }</span>

        <span class="cov0" title="0">err = DB.AutoMigrate(&amp;model.Role{})
        if err != nil </span><span class="cov0" title="0">{
                log.Fatalf("Failed to migrate database: %v", err)
        }</span>

        <span class="cov0" title="0">err = DB.AutoMigrate(&amp;model.User{})
        if err != nil </span><span class="cov0" title="0">{
                log.Fatalf("Failed to migrate database: %v", err)
        }</span>

        <span class="cov0" title="0">err = DB.AutoMigrate(&amp;model.UserRole{})
        if err != nil </span><span class="cov0" title="0">{
                log.Fatalf("Failed to migrate database: %v", err)
        }</span>

        <span class="cov0" title="0">log.Println("Database connection established")

        return DB</span>
}
</pre>
		
		<pre class="file" id="file5" style="display: none">package environmentVariable

import (
        "log"
        "strconv"

        model "github.com/E-Furqan/Food-Delivery-System/Models"
        utils "github.com/E-Furqan/Food-Delivery-System/Utils"
        "github.com/joho/godotenv"
)

func ReadDatabaseEnv() model.DatabaseEnv <span class="cov8" title="1">{
        var DatabaseEnv model.DatabaseEnv

        err := godotenv.Load()
        if err != nil </span><span class="cov8" title="1">{
                log.Printf("Error loading .env file: %v", err)
        }</span>

        <span class="cov8" title="1">DatabaseEnv.DATABASE_HOST = utils.GetEnv("DATABASE_HOST", "db")
        DatabaseEnv.DATABASE_USER = utils.GetEnv("DATABASE_USER", "furqan")
        DatabaseEnv.DATABASE_PASSWORD = utils.GetEnv("DATABASE_PASSWORD", "furqan")
        DatabaseEnv.DATABASE_NAME = utils.GetEnv("DATABASE_NAME", "User")

        portStr := utils.GetEnv("DATABASE_PORT", "5432")
        DatabaseEnv.DATABASE_PORT, err = strconv.Atoi(portStr)
        if err != nil </span><span class="cov0" title="0">{
                log.Printf("Error converting PORT to integer: %v", err)
                DatabaseEnv.DATABASE_PORT = 5432
        }</span>

        <span class="cov8" title="1">return DatabaseEnv</span>
}

func ReadOrderClientEnv() model.OrderClientEnv <span class="cov0" title="0">{
        var OrderClientEnv model.OrderClientEnv

        err := godotenv.Load()
        if err != nil </span><span class="cov0" title="0">{
                log.Printf("Error loading .env file: %v", err)
        }</span>
        <span class="cov0" title="0">OrderClientEnv.BASE_URL = utils.GetEnv("BASE_URL", "http://localhost")
        OrderClientEnv.UPDATE_ORDER_STATUS_URL = utils.GetEnv("UPDATE_ORDER_STATUS_URL", "/order/update/status")
        OrderClientEnv.VIEW_ORDERS_URL = utils.GetEnv("USER_ORDERS_URL", "/order/view/orders")
        OrderClientEnv.VIEW_ORDER_WITHOUT_DRIVER_URL = utils.GetEnv("VIEW_ORDER_WITHOUT_DRIVER_URL", "/order/view/without/driver/orders")
        OrderClientEnv.ASSIGN_DRIVER_URL = utils.GetEnv("ASSIGN_DRIVER_URL", "/order/assign/diver")
        OrderClientEnv.ORDER_PORT = utils.GetEnv("ORDER_PORT", ":8081")

        return OrderClientEnv</span>
}

func ReadAuthClientEnv() model.AuthClientEnv <span class="cov0" title="0">{
        var AuthClientEnv model.AuthClientEnv

        err := godotenv.Load()
        if err != nil </span><span class="cov0" title="0">{
                log.Printf("Error loading .env file: %v", err)
        }</span>
        <span class="cov0" title="0">AuthClientEnv.BASE_URL = utils.GetEnv("BASE_URL", "http://localhost")

        AuthClientEnv.GENERATE_TOKEN_URL = utils.GetEnv("GENERATE_TOKEN_URL", "/auth/generate/token")
        AuthClientEnv.REFRESH_TOKEN_URL = utils.GetEnv("REFRESH_TOKEN_URL", "/auth/refresh/token")

        AuthClientEnv.AUTH_PORT = utils.GetEnv("AUTH_PORT", ":8084")
        return AuthClientEnv</span>
}

func ReadMiddlewareEnv() model.MiddlewareEnv <span class="cov0" title="0">{
        var MiddlewareEnv model.MiddlewareEnv

        MiddlewareEnv.JWT_SECRET = utils.GetEnv("JWT_SECRET", "Furqan")
        MiddlewareEnv.RefreshTokenKey = utils.GetEnv("REFRESH_TOKEN_SECRET", "Ali")

        return MiddlewareEnv
}</span>
</pre>
		
		<pre class="file" id="file6" style="display: none">package Middleware

import (
        "log"
        "net/http"
        "strings"

        "github.com/E-Furqan/Food-Delivery-System/Client/AuthClient"
        model "github.com/E-Furqan/Food-Delivery-System/Models"
        utils "github.com/E-Furqan/Food-Delivery-System/Utils"
        "github.com/dgrijalva/jwt-go"
        "github.com/gin-gonic/gin"
)

type Middleware struct {
        AuthClient *AuthClient.AuthClient
        envVar     *model.MiddlewareEnv
}

func NewMiddleware(AuthClient *AuthClient.AuthClient, envVar *model.MiddlewareEnv) *Middleware <span class="cov0" title="0">{
        return &amp;Middleware{
                AuthClient: AuthClient,
                envVar:     envVar,
        }
}</span>

func (middle *Middleware) AuthMiddleware() gin.HandlerFunc <span class="cov0" title="0">{
        return func(c *gin.Context) </span><span class="cov0" title="0">{
                tokenString := c.GetHeader("Authorization")
                if tokenString == "" || !strings.HasPrefix(tokenString, "Bearer ") </span><span class="cov0" title="0">{
                        utils.GenerateResponse(http.StatusNotFound, c, "error", "Authorization token required", "", nil)
                        c.Abort()
                        return
                }</span>

                <span class="cov0" title="0">tokenString = strings.TrimPrefix(tokenString, "Bearer ")

                claims := &amp;model.Claims{}
                token, err := jwt.ParseWithClaims(tokenString, claims, func(token *jwt.Token) (interface{}, error) </span><span class="cov0" title="0">{
                        return []byte(middle.envVar.JWT_SECRET), nil
                }</span>)
                <span class="cov0" title="0">if err != nil || !token.Valid </span><span class="cov0" title="0">{
                        log.Print(middle.envVar.JWT_SECRET)
                        utils.GenerateResponse(http.StatusUnauthorized, c, "error", err.Error(), "", nil)
                        c.Abort()
                        return
                }</span>
                <span class="cov0" title="0">c.Set("userId", claims.ClaimId)
                c.Set("activeRole", claims.Role)
                c.Next()</span>
        }
}

func (ctrl *Middleware) RefreshToken(c *gin.Context) <span class="cov0" title="0">{

        var input model.RefreshToken

        if err := c.ShouldBindJSON(&amp;input); err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusBadRequest, c, "error", err.Error(), "", nil)
                return
        }</span>

        <span class="cov0" title="0">var refreshClaim model.RefreshToken
        refreshClaim.RefreshToken = input.RefreshToken
        refreshClaim.Role = input.Role
        tokens, err := ctrl.AuthClient.RefreshToken(refreshClaim)
        if err != nil </span><span class="cov0" title="0">{
                utils.GenerateResponse(http.StatusInternalServerError, c, "Message", "Could not generate token", "error", err.Error())
                return
        }</span>

        <span class="cov0" title="0">c.JSON(http.StatusOK, gin.H{
                "access token":  tokens.AccessToken,
                "refresh token": tokens.RefreshToken,
                "expires at":    tokens.Expiration,
        })</span>
}
</pre>
		
		<pre class="file" id="file7" style="display: none">package database_test

import (
        "fmt"
        "log"

        environmentVariable "github.com/E-Furqan/Food-Delivery-System/EnviormentVariable"
        model "github.com/E-Furqan/Food-Delivery-System/Models"
        "github.com/joho/godotenv"
        "gorm.io/driver/postgres"
        "gorm.io/gorm"
)

var DB *gorm.DB

func ConfigTestDatabaseConnection() *gorm.DB <span class="cov8" title="1">{
        envVar := environmentVariable.ReadDatabaseEnv()

        err := godotenv.Load()
        if err != nil </span><span class="cov8" title="1">{
                log.Printf("Error loading .env file: %v", err)
        }</span>

        <span class="cov8" title="1">var connection_string = fmt.Sprintf("host=%s port=%d user=%s password=%s dbname=%s sslmode=disable",
                "0.0.0.0", 5430, envVar.DATABASE_USER, envVar.DATABASE_PASSWORD, "testuser")

        DB, err = gorm.Open(postgres.Open(connection_string), &amp;gorm.Config{})
        if err != nil </span><span class="cov0" title="0">{
                log.Fatalf("Failed to connect to database: %v", err)
        }</span>

        <span class="cov8" title="1">err = DB.AutoMigrate(&amp;model.User{})
        if err != nil </span><span class="cov0" title="0">{
                log.Fatalf("Failed to migrate database: %v", err)
        }</span>

        <span class="cov8" title="1">err = DB.AutoMigrate(&amp;model.Role{})
        if err != nil </span><span class="cov0" title="0">{
                log.Fatalf("Failed to migrate database: %v", err)
        }</span>

        <span class="cov8" title="1">err = DB.AutoMigrate(&amp;model.UserRole{})
        if err != nil </span><span class="cov0" title="0">{
                log.Fatalf("Failed to migrate database: %v", err)
        }</span>

        <span class="cov8" title="1">log.Println("Database connection established")

        return DB</span>
}
</pre>
		
		<pre class="file" id="file8" style="display: none">package database

import (
        "fmt"
        "log"

        model "github.com/E-Furqan/Food-Delivery-System/Models"
        "gorm.io/gorm"
)

type Repository struct {
        DB *gorm.DB
}

func NewRepository(db *gorm.DB) *Repository <span class="cov0" title="0">{
        return &amp;Repository{
                DB: db,
        }
}</span>

func (repo *Repository) CreateRole(role *model.Role) error <span class="cov8" title="1">{
        result := repo.DB.Create(role)
        if result.Error != nil </span><span class="cov8" title="1">{
                log.Printf("Error creating role: %v", result.Error)
                return result.Error
        }</span>
        <span class="cov8" title="1">return nil</span>
}

func (repo *Repository) CreateUser(user *model.User) error <span class="cov8" title="1">{
        result := repo.DB.Create(user)
        repo.LoadUserWithRoles(user)
        return result.Error
}</span>

func (repo *Repository) LoadUserWithRoles(user *model.User) error <span class="cov8" title="1">{

        err := repo.DB.Preload("Roles").First(user, user.UserId).Error
        if err != nil </span><span class="cov8" title="1">{
                log.Printf("Error loading user with roles: %v", err)
                return err
        }</span>

        <span class="cov8" title="1">return nil</span>
}

func (repo *Repository) GetUser(columnName string, findParameter interface{}, user *model.User) error <span class="cov8" title="1">{
        query := fmt.Sprintf("%s = ?", columnName)
        err := repo.DB.Where(query, findParameter).First(user).Error
        if err != nil </span><span class="cov8" title="1">{
                log.Printf("Error : %s", err)
                return err
        }</span>
        <span class="cov8" title="1">err = repo.LoadUserWithRoles(user)

        return err</span>
}

func (repo *Repository) GetRole(RoleId uint, role *model.Role) error <span class="cov8" title="1">{

        err := repo.DB.Where("role_id = ?", RoleId).First(role).Error
        return err
}</span>

func (repo *Repository) FetchUsersWithRoles(columnName string, order string) ([]model.User, error) <span class="cov8" title="1">{

        if columnName == "" </span><span class="cov8" title="1">{
                columnName = "user_id"
        }</span>
        <span class="cov8" title="1">if order == "" </span><span class="cov8" title="1">{
                order = "asc"
        }</span>
        <span class="cov8" title="1">query := fmt.Sprintf("%s %v", columnName, order)

        var user_data []model.User
        err := repo.DB.Preload("Roles").Order(query).Find(&amp;user_data).Error

        return user_data, err</span>
}

func (repo *Repository) GetAllRoles() ([]model.Role, error) <span class="cov8" title="1">{

        var roles []model.Role

        err := repo.DB.Find(&amp;roles).Error

        return roles, err
}</span>

func (repo *Repository) Update(user *model.User, update_user *model.User) error <span class="cov8" title="1">{
        err := repo.DB.Model(user).Where("user_id = ?", user.UserId).Updates(update_user).Error
        _ = repo.LoadUserWithRoles(user)
        return err
}</span>

func (repo *Repository) DeleteUser(user *model.User) error <span class="cov8" title="1">{
        err := repo.DB.Delete(user).Error
        return err
}</span>

func (repo *Repository) DeleteRole(Role *model.Role) error <span class="cov8" title="1">{
        err := repo.DB.Delete(Role).Error
        return err
}</span>

func (repo *Repository) BulkCreateRoles(roles []model.Role) error <span class="cov8" title="1">{
        result := repo.DB.Create(&amp;roles)
        if result.Error != nil </span><span class="cov8" title="1">{
                log.Printf("Error creating role: %v", result.Error)
                return result.Error
        }</span>
        <span class="cov8" title="1">return nil</span>
}

func (repo *Repository) DeleteUserRoleInfo(ID uint, columnName string) error <span class="cov8" title="1">{
        var UserRole model.UserRole
        query := fmt.Sprintf("%s = ?", columnName)

        result := repo.DB.Where(query, ID).Delete(&amp;UserRole)

        return result.Error
}</span>

func (repo *Repository) AddUserRole(userId uint, roleId uint) error <span class="cov8" title="1">{

        var existingUserRole model.UserRole
        if err := repo.DB.Where("user_user_id = ? AND role_role_id = ?", userId, roleId).First(&amp;existingUserRole).Error; err == nil </span><span class="cov8" title="1">{
                return nil
        }</span>

        <span class="cov8" title="1">userRole := model.UserRole{
                UserId: userId,
                RoleId: roleId,
        }
        err := repo.DB.Create(&amp;userRole).Error
        return err</span>
}

func (repo *Repository) UpdateUserActiveRole(user *model.User) error <span class="cov8" title="1">{
        return repo.DB.Model(user).Where("user_id = ?", user.UserId).Update("active_role", user.ActiveRole).Error
}</span>

func (repo *Repository) UpdateRoleStatus(user *model.User) error <span class="cov8" title="1">{
        return repo.DB.Model(user).Where("user_id = ?", user.UserId).Update("role_status", user.RoleStatus).Error
}</span>
</pre>
		
		<pre class="file" id="file9" style="display: none">package route

import (
        roleController "github.com/E-Furqan/Food-Delivery-System/Controllers/RoleControler"
        UserControllers "github.com/E-Furqan/Food-Delivery-System/Controllers/UserController"
        "github.com/E-Furqan/Food-Delivery-System/Middleware"

        "github.com/gin-gonic/gin"
)

func User_routes(ctrl *UserControllers.Controller, rCtrl *roleController.RoleController, middleware *Middleware.Middleware, server *gin.Engine) <span class="cov0" title="0">{

        user := server.Group("/user")
        user.POST("/register", ctrl.Register)
        user.POST("/login", ctrl.Login)
        user.POST("/refresh/token", middleware.RefreshToken)

        user.Use(middleware.AuthMiddleware())
        </span><span class="cov0" title="0">{
                user.POST("/assign/driver", ctrl.AssignDriver)

                user.GET("/get/roles", rCtrl.GetRoles)
                user.GET("/get/users", ctrl.GetUsers)
                user.GET("/profile", ctrl.Profile)
                user.GET("/view/user/orders", ctrl.ViewUserOrders)
                user.GET("/view/driver/orders", ctrl.ViewDriverOrders)
                user.GET("/view/orders/without/driver", ctrl.ViewOrdersWithoutDriver)

                user.PATCH("/update/order/status", ctrl.UpdateOrderStatus)
                user.PATCH("/update/profile", ctrl.UpdateUser)
                user.PATCH("/switch/role", rCtrl.SwitchRole)

                user.DELETE("/delete/user", ctrl.DeleteUser)
                user.DELETE("/delete/role", rCtrl.DeleteRole)

                user.POST("/add/role", rCtrl.AddRolesByAdmin)
                user.POST("/search/user", ctrl.SearchForUser)

        }</span>
}
</pre>
		
		<pre class="file" id="file10" style="display: none">package utils

import (
        "fmt"
        "net/http"
        "os"
        "strings"

        model "github.com/E-Furqan/Food-Delivery-System/Models"
        "github.com/gin-gonic/gin"
)

func GenerateResponse(httpStatusCode int, c *gin.Context, title1 string, message1 string, title2 string, input interface{}) <span class="cov0" title="0">{

        errorMessage := strings.TrimPrefix(message1, "ERROR: ")
        response := gin.H{
                title1: errorMessage,
        }

        if title2 != "" &amp;&amp; input != nil </span><span class="cov0" title="0">{
                response[title2] = input
        }</span>

        <span class="cov0" title="0">c.JSON(httpStatusCode, response)</span>
}

func VerifyUserId(c *gin.Context) (any, error) <span class="cov0" title="0">{
        userIdValue, exists := c.Get("userId")
        if !exists </span><span class="cov0" title="0">{
                return 0, fmt.Errorf("userId does not exist")
        }</span>
        <span class="cov0" title="0">userId, ok := userIdValue.(uint)
        if !ok </span><span class="cov0" title="0">{
                return 0, fmt.Errorf("invalid userId")
        }</span>
        <span class="cov0" title="0">return userId, nil</span>
}

func VerifyActiveRole(c *gin.Context) (any, error) <span class="cov0" title="0">{
        activeRole, exists := c.Get("activeRole")
        if !exists </span><span class="cov0" title="0">{
                return activeRole, fmt.Errorf("invalid Role Type")
        }</span>

        <span class="cov0" title="0">if activeRole != "Admin" </span><span class="cov0" title="0">{
                return activeRole, fmt.Errorf("insufficient permissions")
        }</span>

        <span class="cov0" title="0">return activeRole, nil</span>
}

func CreateUserClaim(user model.User) model.UserClaim <span class="cov0" title="0">{
        var UserClaim model.UserClaim
        UserClaim.UserId = user.UserId
        UserClaim.ActiveRole = user.ActiveRole
        return UserClaim
}</span>

func GetEnv(key string, defaultVal string) string <span class="cov8" title="1">{
        if value := os.Getenv(key); value != "" </span><span class="cov0" title="0">{
                return value
        }</span>
        <span class="cov8" title="1">return defaultVal</span>
}

func GetAuthToken(c *gin.Context) string <span class="cov0" title="0">{
        authHeader := c.GetHeader("Authorization")
        if authHeader == "" </span><span class="cov0" title="0">{
                GenerateResponse(http.StatusUnauthorized, c, "Message", "authorization token not provided", "error", nil)
                return ""
        }</span>
        <span class="cov0" title="0">tokenParts := strings.Split(authHeader, " ")
        if len(tokenParts) != 2 || tokenParts[0] != "Bearer" </span><span class="cov0" title="0">{
                GenerateResponse(http.StatusUnauthorized, c, "Message", "invalid authorization header format", "error", nil)
                return ""
        }</span>
        <span class="cov0" title="0">token := tokenParts[1]
        return token</span>
}
</pre>
		
		<pre class="file" id="file11" style="display: none">package main

import (
        "github.com/E-Furqan/Food-Delivery-System/Client/AuthClient"
        "github.com/E-Furqan/Food-Delivery-System/Client/OrderClient"
        RoleController "github.com/E-Furqan/Food-Delivery-System/Controllers/RoleControler"
        UserControllers "github.com/E-Furqan/Food-Delivery-System/Controllers/UserController"
        config "github.com/E-Furqan/Food-Delivery-System/DatabaseConfig"
        environmentVariable "github.com/E-Furqan/Food-Delivery-System/EnviormentVariable"
        "github.com/E-Furqan/Food-Delivery-System/Middleware"
        database "github.com/E-Furqan/Food-Delivery-System/Repositories"
        route "github.com/E-Furqan/Food-Delivery-System/Route"
        "github.com/gin-gonic/gin"
)

func main() <span class="cov0" title="0">{
        DatabaseEnv := environmentVariable.ReadDatabaseEnv()
        OrderClientEnv := environmentVariable.ReadOrderClientEnv()
        AuthClientEnv := environmentVariable.ReadAuthClientEnv()
        MiddlewareEnv := environmentVariable.ReadMiddlewareEnv()

        databaseConfig := config.NewDatabase(DatabaseEnv)
        db := databaseConfig.Connection()
        repo := database.NewRepository(db)

        OrdClient := OrderClient.NewClient(OrderClientEnv)
        AuthClient := AuthClient.NewClient(AuthClientEnv)

        ctrl := UserControllers.NewController(repo, OrdClient, AuthClient)
        rCtrl := RoleController.NewController(repo, AuthClient)

        middle := Middleware.NewMiddleware(AuthClient, &amp;MiddlewareEnv)

        server := gin.Default()

        rCtrl.AddDefaultRoles(nil)

        route.User_routes(ctrl, rCtrl, middle, server)

        server.Run(":8083")
}</span>
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
